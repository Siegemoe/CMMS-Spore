generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                  String        @id @default(cuid())
  email               String        @unique
  name                String?
  password            String
  role                String        @default("USER")
  createdAt           DateTime      @default(now())
  updatedAt           DateTime      @updatedAt
  activityLogs        ActivityLog[]
  assets              Asset[]
  assignedWorkOrders  WorkOrder[]   @relation("AssignedWorkOrders")
  createdWorkOrders   WorkOrder[]   @relation("CreatedWorkOrders")
  requestedWorkOrders WorkOrder[]   @relation("RequestedWorkOrders")

  @@map("users")
}

model Asset {
  id           String      @id @default(cuid())
  name         String
  description  String?
  assetTag     String?     @unique
  category     String
  location     String
  status       String      @default("ACTIVE")
  purchaseDate DateTime?
  purchaseCost Float?
  warrantyEnd  DateTime?
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt
  createdById  String?
  createdBy    User?       @relation(fields: [createdById], references: [id])
  workOrders   WorkOrder[]

  @@index([category])
  @@index([location])
  @@index([status])
  @@index([createdById])
  @@map("assets")
}

model WorkOrder {
  id                  String    @id @default(cuid())
  workOrderNumber     String    @unique
  title               String
  description         String?
  priority            String    @default("MEDIUM")
  status              String    @default("OPEN")
  assetId             String
  assetLocation       String?
  workType            String
  scopeOfWork         String?
  partsRequired       String?
  toolsRequired       String?
  otherResources      String?
  safetyNotes         String?
  estimatedStart      DateTime?
  estimatedCompletion DateTime?
  actualStart         DateTime?
  actualCompletion    DateTime?
  completedAt         DateTime?
  assignedToId        String?
  createdById         String
  requestedById       String?
  completionNotes     String?
  signOff             String?
  attachments         String?
  ticketType          String?
  siteLocation        String?
  roomLocation        String?
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt
  asset               Asset     @relation(fields: [assetId], references: [id])
  assignedTo          User?     @relation("AssignedWorkOrders", fields: [assignedToId], references: [id])
  createdBy           User      @relation("CreatedWorkOrders", fields: [createdById], references: [id])
  requestedBy         User?     @relation("RequestedWorkOrders", fields: [requestedById], references: [id])

  @@index([status])
  @@index([priority])
  @@index([assetId])
  @@index([createdById])
  @@index([assignedToId])
  @@index([workOrderNumber])
  @@map("work_orders")
}

model ActivityLog {
  id          String   @id @default(cuid())
  action      String
  entityType  String
  entityId    String
  entityName  String?
  description String
  details     String?
  userId      String
  userName    String
  createdAt   DateTime @default(now())
  user        User     @relation(fields: [userId], references: [id])

  @@index([entityType, entityId])
  @@index([createdAt])
  @@map("activity_logs")
}
