generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                  String        @id @default(cuid())
  email               String        @unique
  name                String?
  password            String
  role                String        @default("USER")
  createdAt           DateTime      @default(now())
  updatedAt           DateTime      @updatedAt
  activityLogs        ActivityLog[]
  assets              Asset[]
  assignedWorkOrders  WorkOrder[]   @relation("AssignedWorkOrders")
  createdWorkOrders   WorkOrder[]   @relation("CreatedWorkOrders")
  requestedWorkOrders WorkOrder[]   @relation("RequestedWorkOrders")
  managedSites        Site[]        @relation("SiteManager")
  maintainedBuildings Building[]    @relation("FacilityTechnician")

  @@map("users")
}

model Site {
  id              String      @id @default(cuid())
  name            String
  address         String?
  description     String?
  status          String      @default("ACTIVE")
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
  siteManagerId   String?
  siteManager     User?       @relation("SiteManager", fields: [siteManagerId], references: [id])
  buildings       Building[]
  assets          Asset[]

  @@index([status])
  @@index([siteManagerId])
  @@map("sites")
}

model Building {
  id                    String      @id @default(cuid())
  name                  String
  number                String
  description           String?
  floors                Int?
  status                String      @default("ACTIVE")
  createdAt             DateTime    @default(now())
  updatedAt             DateTime    @updatedAt
  siteId                String
  site                  Site        @relation(fields: [siteId], references: [id], onDelete: Cascade)
  facilityTechnicianId  String?
  facilityTechnician    User?       @relation("FacilityTechnician", fields: [facilityTechnicianId], references: [id])
  rooms                 Room[]
  assets                Asset[]

  @@index([siteId])
  @@index([status])
  @@index([facilityTechnicianId])
  @@map("buildings")
}

model Room {
  id                String      @id @default(cuid())
  number            String
  description       String?
  floor             Int?
  squareFootage     Float?
  status            RoomStatus  @default(AVAILABLE)
  thumbnailImage    String?
  createdAt         DateTime    @default(now())
  updatedAt         DateTime    @updatedAt
  buildingId        String
  building          Building    @relation(fields: [buildingId], references: [id], onDelete: Cascade)
  tenantId          String?
  tenant            Tenant?     @relation(fields: [tenantId], references: [id])
  assets            Asset[]

  @@index([buildingId])
  @@index([status])
  @@index([tenantId])
  @@map("rooms")
}

model Tenant {
  id            String      @id @default(cuid())
  names         String      // Can be multiple names separated by commas
  phoneNumbers  String      // Can be multiple phone numbers separated by commas
  email         String?
  status        String      @default("ACTIVE")
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
  rooms         Room[]

  @@index([status])
  @@map("tenants")
}

enum RoomStatus {
  AVAILABLE
  OCCUPIED
  CLEANING
  MAINTENANCE
  OUT_OF_SERVICE
}

model Asset {
  id           String      @id @default(cuid())
  name         String
  description  String?
  assetTag     String?     @unique
  category     String
  location     String
  status       String      @default("ACTIVE")
  purchaseDate DateTime?
  purchaseCost Float?
  warrantyEnd  DateTime?
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt
  createdById  String?
  createdBy    User?       @relation(fields: [createdById], references: [id])
  siteId       String?
  buildingId   String?
  roomId       String?
  site         Site?       @relation(fields: [siteId], references: [id])
  building     Building?   @relation(fields: [buildingId], references: [id])
  room         Room?       @relation(fields: [roomId], references: [id])
  workOrders   WorkOrder[]

  @@index([category])
  @@index([location])
  @@index([status])
  @@index([createdById])
  @@index([siteId])
  @@index([buildingId])
  @@index([roomId])
  @@map("assets")
}

model WorkOrder {
  id                  String    @id @default(cuid())
  workOrderNumber     String    @unique
  title               String
  description         String?
  priority            String    @default("MEDIUM")
  status              String    @default("OPEN")
  assetId             String
  assetLocation       String?
  workType            String
  scopeOfWork         String?
  partsRequired       String?
  toolsRequired       String?
  otherResources      String?
  safetyNotes         String?
  estimatedStart      DateTime?
  estimatedCompletion DateTime?
  actualStart         DateTime?
  actualCompletion    DateTime?
  completedAt         DateTime?
  assignedToId        String?
  createdById         String
  requestedById       String?
  completionNotes     String?
  signOff             String?
  attachments         String?
  ticketType          String?
  siteLocation        String?
  roomLocation        String?
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt
  asset               Asset     @relation(fields: [assetId], references: [id])
  assignedTo          User?     @relation("AssignedWorkOrders", fields: [assignedToId], references: [id])
  createdBy           User      @relation("CreatedWorkOrders", fields: [createdById], references: [id])
  requestedBy         User?     @relation("RequestedWorkOrders", fields: [requestedById], references: [id])

  @@index([status])
  @@index([priority])
  @@index([assetId])
  @@index([createdById])
  @@index([assignedToId])
  @@index([workOrderNumber])
  @@map("work_orders")
}

model ActivityLog {
  id          String   @id @default(cuid())
  action      String
  entityType  String
  entityId    String
  entityName  String?
  description String
  details     String?
  userId      String
  userName    String
  createdAt   DateTime @default(now())
  user        User     @relation(fields: [userId], references: [id])

  @@index([entityType, entityId])
  @@index([createdAt])
  @@map("activity_logs")
}
